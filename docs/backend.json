
{
  "entities": {
    "Business": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Business",
      "type": "object",
      "description": "Represents a business using the ShopFront platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Business entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the business."
        },
        "logoUrl": {
          "type": "string",
          "description": "URL of the business's logo.",
          "format": "uri"
        },
        "tagline": {
          "type": "string",
          "description": "Tagline of the business."
        },
        "description": {
          "type": "string",
          "description": "Description of the business."
        },
        "contactInfo": {
          "type": "string",
          "description": "Contact information for the business."
        },
        "subscriptionId": {
          "type": "string",
          "description": "Reference to Subscription plan. (Relationship: Subscription 1:N Business)"
        },
        "ownerId": {
          "type": "string",
          "description": "Firebase Auth UID of the user who owns this business."
        },
        "theme": {
          "type": "object",
          "description": "AI-generated or user-defined theme for the storefront. Includes separate light and dark palettes.",
          "properties": {
            "background": { "type": "string", "description": "HSL value for light background." },
            "foreground": { "type": "string", "description": "HSL value for light text." },
            "card": { "type": "string", "description": "HSL value for light card backgrounds." },
            "primary": { "type": "string", "description": "HSL value for light primary elements." },
            "primaryForeground": { "type": "string", "description": "HSL value for text on light primary elements." },
            "secondary": { "type": "string", "description": "HSL value for light secondary elements." },
            "secondaryForeground": { "type": "string", "description": "HSL value for text on light secondary elements." },
            "accent": { "type": "string", "description": "HSL value for light accent color." },
            "accentForeground": { "type": "string", "description": "HSL value for text on light accent elements." },
            "dark": {
              "type": "object",
              "description": "The theme palette for dark mode.",
              "properties": {
                "background": { "type": "string", "description": "HSL value for dark background." },
                "foreground": { "type": "string", "description": "HSL value for dark text." },
                "card": { "type": "string", "description": "HSL value for dark card backgrounds." },
                "primary": { "type": "string", "description": "HSL value for dark primary elements." },
                "primaryForeground": { "type": "string", "description": "HSL value for text on dark primary elements." },
                "secondary": { "type": "string", "description": "HSL value for dark secondary elements." },
                "secondaryForeground": { "type": "string", "description": "HSL value for text on dark secondary elements." },
                "accent": { "type": "string", "description": "HSL value for dark accent color." },
                "accentForeground": { "type": "string", "description": "HSL value for text on dark accent elements." }
              }
            }
          }
        },
        "customDomain": {
          "type": "string",
          "description": "The custom domain assigned to this business's storefront."
        },
        "layout": {
            "type": "string",
            "enum": ["Grid", "Carousel", "Minimalist"],
            "description": "The selected layout for the storefront homepage."
        },
        "fontDescription": {
            "type": "string",
            "description": "The user's text description for their desired font style."
        },
        "fontPair": {
            "type": "object",
            "description": "The selected pair of Google Fonts for the storefront.",
            "properties": {
                "headlineFont": { "type": "string" },
                "bodyFont": { "type": "string" }
            }
        },
        "showHeroSection": {
          "type": "boolean",
          "description": "Whether to show the hero section on the storefront."
        },
        "heroImageUrl": {
            "type": "string",
            "description": "URL of the AI-generated or uploaded hero image for the storefront."
        },
        "fulfillment": {
          "type": "object",
          "description": "Settings for order fulfillment and payment.",
          "properties": {
            "delivery": {
              "type": "object",
              "properties": {
                "enabled": { "type": "boolean" },
                "fee": { "type": "number", "description": "Flat shipping fee." }
              }
            },
            "pickup": {
              "type": "object",
              "properties": {
                "enabled": { "type": "boolean" },
                "address": { "type": "string", "description": "Address for in-store pickup." }
              }
            },
            "payment": {
              "type": "object",
              "properties": {
                "payOnDelivery": {
                  "type": "object",
                  "properties": {
                    "enabled": { "type": "boolean" }
                  }
                },
                "payOnline": {
                  "type": "object",
                  "properties": {
                    "enabled": { "type": "boolean" }
                  }
                }
              }
            }
          }
        },
        "flutterwavePublicKey": {
          "type": "string",
          "description": "The business owner's public key for Flutterwave."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "contactInfo",
        "subscriptionId",
        "ownerId"
      ]
    },
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a product offered by a business.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Product entity."
        },
        "businessId": {
          "type": "string",
          "description": "Reference to Business. (Relationship: Business 1:N Product)"
        },
        "title": {
          "type": "string",
          "description": "Title of the product."
        },
        "description": {
          "type": "string",
          "description": "Description of the product."
        },
        "price": {
          "type": "number",
          "description": "Price of the product."
        },
        "discountedPrice": {
          "type": "number",
          "description": "Discounted price of the product (optional)."
        },
        "category": {
          "type": "string",
          "description": "Category of the product (e.g., from a dropdown)."
        },
        "isFeatured": {
          "type": "boolean",
          "description": "Indicates if the product is featured."
        },
        "imageUrls": {
          "type": "array",
          "description": "URLs of the product images.",
          "items": {
            "type": "string",
            "format": "uri"
          }
        },
        "ownerId": {
            "type": "string",
            "description": "Firebase Auth UID of the user who created this product."
        },
        "status": {
            "type": "string",
            "enum": ["draft", "published", "archived"],
            "description": "The status of the product."
        }
      },
      "required": [
        "id",
        "businessId",
        "title",
        "description",
        "price",
        "isFeatured",
        "ownerId",
        "status"
      ]
    },
    "Subscription": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Subscription",
      "type": "object",
      "description": "Represents a subscription plan for businesses.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Subscription entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the subscription plan (e.g., Basic, Standard)."
        },
        "price": {
          "type": "number",
          "description": "Price of the subscription plan per month."
        },
        "features": {
          "type": "string",
          "description": "Description of features included in the subscription plan."
        }
      },
      "required": [
        "id",
        "name",
        "price",
        "features"
      ]
    },
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents an order placed by a user.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the Order entity." },
        "businessId": { "type": "string", "description": "Reference to Business. (Relationship: Business 1:N Order)" },
        "customerId": { "type": "string", "description": "The ID of the customer who placed the order." },
        "customerName": { "type": "string", "description": "The name of the customer for display purposes." },
        "orderDate": { "type": "string", "description": "Date and time when the order was placed.", "format": "date-time" },
        "totalAmount": { "type": "number", "description": "Total amount of the order." },
        "shippingAddress": { "type": "string", "description": "Shipping address for the order (if applicable)." },
        "fulfillmentMethod": { "type": "string", "enum": ["delivery", "pickup"], "description": "How the order will be fulfilled." },
        "paymentMethod": { "type": "string", "enum": ["online", "on_delivery"], "description": "How the order was paid for." },
        "paymentStatus": { "type": "string", "enum": ["paid", "unpaid"], "description": "The payment status of the order."},
        "orderStatus": { "type": "string", "description": "Status of the order (e.g., pending, processing, shipped, delivered, cancelled)." },
        "transactionId": { "type": "string", "description": "The transaction ID from online payment provider if paid online."},
        "statusUpdateAudioUrl": { "type": "string", "description": "A data URI for a TTS audio clip updating the customer on the order status." },
        "items": {
          "type": "array",
          "description": "Array of items included in the order.",
          "items": {
            "type": "object",
            "properties": {
              "productId": { "type": "string" },
              "title": { "type": "string" },
              "quantity": { "type": "integer" },
              "price": { "type": "number" }
            },
            "required": ["productId", "title", "quantity", "price"]
          }
        }
      },
      "required": [
        "id",
        "businessId",
        "customerId",
        "customerName",
        "orderDate",
        "totalAmount",
        "fulfillmentMethod",
        "paymentMethod",
        "paymentStatus",
        "orderStatus",
        "items"
      ]
    },
    "Customer": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "Customer",
        "type": "object",
        "description": "Represents a customer of a specific business.",
        "properties": {
            "id": {
                "type": "string",
                "description": "Unique identifier for the Customer entity (matches Firebase Auth UID)."
            },
            "businessId": {
                "type": "string",
                "description": "Reference to the Business this customer belongs to."
            },
            "username": {
                "type": "string",
                "description": "The customer's chosen username."
            },
            "email": {
                "type": "string",
                "format": "email",
                "description": "The customer's email address."
            },
            "cart": {
                "type": "array",
                "description": "The customer's server-side shopping cart.",
                "items": {
                    "type": "object",
                    "properties": {
                        "productId": {"type": "string"},
                        "quantity": {"type": "integer"}
                    },
                    "required": ["productId", "quantity"]
                }
            }
        },
        "required": ["id", "businessId", "username", "email", "cart"]
    },
    "Category": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Category",
      "type": "object",
      "description": "Represents a product category for a business.",
      "properties": {
          "id": { "type": "string", "description": "Unique ID for the category." },
          "name": { "type": "string", "description": "The name of the category." }
      },
      "required": ["id", "name"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/businesses/{businessId}",
        "definition": {
          "entityName": "Business",
          "schema": {
            "$ref": "#/backend/entities/Business"
          },
          "description": "Stores business profiles. Includes denormalized 'subscriptionId' for authorization independence.",
          "params": [
            {
              "name": "businessId",
              "description": "Unique identifier for the business."
            }
          ]
        }
      },
      {
        "path": "/businesses/{businessId}/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores products associated with a specific business.",
          "params": [
            {
              "name": "businessId",
              "description": "Unique identifier for the business."
            },
            {
              "name": "productId",
              "description": "Unique identifier for the product."
            }
          ]
        }
      },
      {
        "path": "/businesses/{businessId}/categories/{categoryId}",
        "definition": {
            "entityName": "Category",
            "schema": { "$ref": "#/backend/entities/Category" },
            "description": "Stores custom product categories for a specific business.",
            "params": [
                { "name": "businessId", "description": "Unique ID of the parent business." },
                { "name": "categoryId", "description": "Unique ID for the category." }
            ]
        }
      },
      {
        "path": "/businesses/{businessId}/customers/{customerId}",
        "definition": {
            "entityName": "Customer",
            "schema": { "$ref": "#/backend/entities/Customer" },
            "description": "Stores customer data for a specific business.",
            "params": [
                { "name": "businessId", "description": "Unique ID of the parent business." },
                { "name": "customerId", "description": "Unique ID of the customer (matches their auth UID)." }
            ]
        }
      },
      {
        "path": "/subscriptions/{subscriptionId}",
        "definition": {
          "entityName": "Subscription",
          "schema": {
            "$ref": "#/backend/entities/Subscription"
          },
          "description": "Stores subscription plan details.",
          "params": [
            {
              "name": "subscriptionId",
              "description": "Unique identifier for the subscription plan."
            }
          ]
        }
      },
      {
        "path": "/businesses/{businessId}/orders/{orderId}",
        "definition": {
          "entityName": "Order",
          "schema": {
            "$ref": "#/backend/entities/Order"
          },
          "description": "Stores orders placed for a specific business.",
          "params": [
            {
              "name": "businessId",
              "description": "Unique identifier for the business."
            },
            {
              "name": "orderId",
              "description": "Unique identifier for the order."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{uid}",
        "definition": {
          "entityName": "roles_admin",
          "schema": {
            "$ref": "#/backend/entities/roles_admin"
          },
          "description": "Documents in this collection indicate admin privileges. Existence of a document indicates admin role.",
          "params": [
            {
              "name": "uid",
              "description": "The Firebase Auth UID of the administrator."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure authorization independence, clarity, and scalability for the ShopFront application.  Business data and associated products are structured under the `/businesses/{businessId}` path to maintain a clear ownership hierarchy. Subscriptions are managed in a top-level `/subscriptions` collection, and business subscription details are denormalized into the business document itself (via `subscriptionId`), which helps to avoid complex `get()` calls in security rules and enables atomic operations.  Orders are created as a subcollection under businesses at the path `/businesses/{businessId}/orders/{orderId}`. Customers are stored in a subcollection under the business they signed up for at `/businesses/{businessId}/customers/{customerId}` to enforce data isolation between businesses. Product categories are stored in a subcollection at `/businesses/{businessId}/categories/{categoryId}` to be managed per-business. This design supports QAPs by enforcing consistent security rules at each level.  For example, listing products requires that the requesting user has access to the parent business. The admin role is handled via a separate `/roles_admin/{uid}` collection, enabling existence-based rule checks. This structure facilitates secure and efficient data management while adhering to the principles of authorization independence and structural segregation.\\n\\nKey denormalizations:\\n\\n*   `businesses.subscriptionId`: The subscription ID is stored within the business document itself to allow direct rule validation without needing to `get()` the subscription document.\\n*   `businesses.theme`: A set of HSL color values for the public storefront's theme, allowing for AI-driven customization.\\n*   `businesses.customDomain`: The custom domain assigned by the business owner for their storefront.\\n\\nQAP support:\\n\\n*   Listing businesses is restricted to admins (checked via `/roles_admin/{uid}`).\\n*   Listing products is restricted to authorized users who have access to the parent business.\\n*   Orders are secured under the business, ensuring only authorized users can access order information for a specific business.\\n"
  }
}
    